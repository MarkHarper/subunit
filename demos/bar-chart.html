<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script src="../bower_components/threejs/build/three.js"></script>
    <script src="vendor/d3.js"></script>
    <script src="vendor/tween.min.js"></script>
    <script src="../dist/subunit.js"></script>
  </head>
  <body>
  <script type="text/javascript">

    var scene  = new THREE.Scene();

    var camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 10000);
    camera.position.set( 0, 0, 350 );

    var light = new THREE.AmbientLight(0xffffff);
    scene.add(light);

    var light = new THREE.DirectionalLight('#36648B', 2);
    light.position.set( 10, 10, 10 ).normalize();
    scene.add(light);

    var canvas = d3.select("body").append("canvas")
      .attr("width", window.innerWidth)
      .attr("height", window.innerHeight);

    canvas.node().getContext("webgl");

    var renderer = new THREE.WebGLRenderer({canvas: canvas.node()});
    renderer.setSize(window.innerWidth, window.innerHeight);

    var blue = new THREE.MeshPhongMaterial({ 
      ambient: '#030303', 
      color: '#4183c4', 
      specular: '#009900', 
      shininess: 10
    });

    var green = new THREE.MeshPhongMaterial({ 
      ambient: '#030303', 
      color: '#83c441', 
      specular: '#009900', 
      shininess: 10
    });

    var data = [
      {letter: 'A', frequency: .08167},
      {letter: 'B', frequency: .01492},
      {letter: 'C', frequency: .02780},
      {letter: 'D', frequency: .04253},
      {letter: 'E', frequency: .12702},
      {letter: 'F', frequency: .02288},
      {letter: 'G', frequency: .02022},
      {letter: 'H', frequency: .06094},
      {letter: 'I', frequency: .06973},
      {letter: 'J', frequency: .00153},
      {letter: 'K', frequency: .00747},
      {letter: 'L', frequency: .04025},
      {letter: 'M', frequency: .02517},
      {letter: 'N', frequency: .06749},
      {letter: 'O', frequency: .07507},
      {letter: 'P', frequency: .01929},
      {letter: 'Q', frequency: .00098},
      {letter: 'R', frequency: .05987},
      {letter: 'S', frequency: .06333},
      {letter: 'T', frequency: .09056},
      {letter: 'U', frequency: .02758},
      {letter: 'V', frequency: .01037},
      {letter: 'W', frequency: .02465},
      {letter: 'X', frequency: .00150},
      {letter: 'Y', frequency: .01971},
      {letter: 'Z', frequency: .00074}];

    window.d="M0,400.32104198508205L4.824120603015076,398.78171498256694L9.648241206030152,397.2667569052507L14.472361809045225,395.86975731131565L19.296482412060303,394.6841608140822L24.12060301507538,393.8244086818516L28.94472361809045,393.4614347682501L33.768844221105525,393.897562720901L38.59296482412061,395.69264438477387L43.41708542713568,399.661800199635L48.24120603015076,406.2231872005172L53.06532663316583,414.41650984930806L57.8894472361809,422.6026516843007L62.71356783919599,430.0811344355903L67.53768844221105,436.6396014738152L72.36180904522612,441.5716852123488L77.18592964824121,444.2774116261161L82.01005025125627,445.07761481998403L86.83417085427136,445.0094858252332L91.65829145728642,445.0460704139659L96.48241206030151,445.5766550851695L101.30653266331659,446.435831901659L106.13065326633166,447.22769269239325L110.95477386934674,447.61265070412327L115.7788944723618,447.42809680851354L120.60301507537687,446.680665906386L125.42713567839198,445.4874009065704L130.25125628140705,444.0149659489932L135.0753768844221,442.43347622935624L139.89949748743717,440.88610272002836L144.72361809045225,439.47228167522235L149.54773869346735,438.2423630449224L154.37185929648243,437.20127044089577L159.19597989949747,436.3182140654053L164.02010050251255,435.5393405765542L168.84422110552765,434.8005979835025L173.66834170854273,434.0388526013585L178.4924623115578,433.2001625134897L183.31658291457285,432.2448935815341L188.14070351758792,431.14994495895166L192.96482412060303,429.90868911178546L197.7889447236181,428.5293469643285L202.61306532663318,427.0324739073212L207.43718592964822,425.44810111830844L212.26130653266333,423.8129231514939L217.0854271356784,422.16786730356756L221.90954773869348,420.5578727955925L226.73366834170855,419.0531219901544L231.5577889447236,417.91484712768647L236.3819095477387,418.2617776269866L241.20603015075375,423.05205003601753L246.03015075376885,435.2256021387917L250.85427135678395,450.62463389874216L255.67839195979897,456.6762352726687L260.5025125628141,446.876646086132L265.3266331658291,430.2637663894404L270.1507537688442,418.7976130170067L274.9748743718593,414.87198647177564L279.79899497487435,414.99335160695495L284.62311557788945,416.47985495858217L289.4472361809045,418.4450866341359L294.2713567839196,420.7086410390162L299.0954773869347,423.23668221852455L303.91959798994975,426.0298461704477L308.74371859296485,429.1258526879575L313.5678391959799,432.61691259914295L318.39195979899495,436.6555182597944L323.21608040201005,441.42597921419576L328.0402010050251,447.05855852345604L332.8643216080402,453.48260704448217L337.6884422110553,460.2792963450604L342.51256281407035,466.67766071435625L347.33668341708545,471.8087786620121L352.1608040201005,475.12189907394765L356.9849246231156,476.6656419143909L361.80904522613065,477.01255399202245L366.6331658291457,476.91582131522244L371.4572864321608,476.9895683868128L376.28140703517585,477.5945351914588L381.10552763819095,478.8851979066616L385.92964824120605,480.89385860905463L390.7537688442211,483.577237550058L395.5778894472362,486.81060695411463L400.40201005025125,490.3519302282036L405.22613065326635,493.81769659177763L410.0502512562814,496.70610166724026L414.87437185929645,498.4744774453147L419.69849246231155,498.64502724126606L424.52261306532665,496.8965586055688L429.3467336683417,493.1085713230997L434.1708542713568,487.34986419332546L438.99497487437185,479.829358962111L443.81909547738695,470.83779621384554L448.64321608040206,460.7028326562641L453.4673366834171,449.765077058326L458.29145728643215,438.36960226350317L463.1155778894472,426.8624685922056L467.9396984924623,415.5840139665695L472.7638190954774,404.8556778951759L477.58793969849245,394.961242792805L482.4120603015075,386.1257651931143L487.2361809045226,378.4969725915089L492.0603015075377,372.1346093785949L496.8844221105528,367.01196846603364L501.7085427135679,363.0302314068383L506.5326633165829,360.0420122557743L511.35678391959794,357.8781380217893L516.1809045226131,356.3720900185313L521.0050251256282,355.37864818544335L525.8291457286432,354.7855827243388L530.6532663316582,354.5188535204388L535.4773869346733,354.5427145733383L540.3015075376884,354.85698398427786L545.1256281407035,355.49535702788205L549.9497487437186,356.531059159357L554.7738693467336,358.09612678258804L559.5979899497487,360.4095486896276L564.4221105527638,363.78046501599846L569.2462311557789,368.524320226561L574.070351758794,374.76021655087465L578.894472361809,382.17822787227806L583.7185929648241,389.97516224752565L588.5427135678392,397.1006198232042L593.3668341708543,402.73788636186674L598.1909547738694,406.73339927895734L603.0150753768845,409.66882008317566L607.8391959798995,412.5105474577812L612.6633165829146,416.0954750212846L617.4874371859297,420.8084398460177L622.3115577889448,426.5906533695142L627.1356783919598,433.1457868872478L631.9597989949748,440.13988236630723L636.7839195979899,447.2981054379912L641.608040201005,454.41564043583674L646.4321608040201,461.33595195992353L651.2562814070352,467.9308804589465L656.0804020100502,474.0912775930096L660.9045226130653,479.7247324130666L665.7286432160804,484.75571254192727L670.5527638190955,489.1256146331259L675.3768844221106,492.7919227326215L680.2010050251256,495.72633220714204L685.0251256281407,497.9118190639151L689.8492462311558,499.33870326894066L694.6733668341709,500L699.497487437186,499.88681353178714L704.321608040201,498.98522149699426L709.1457286432161,497.2773269141432L713.9698492462312,494.75173776728093L718.7939698492462,491.4328422635398L723.6180904522613,487.43867329759223L728.4422110552763,483.0575244546349L733.2663316582914,478.7773718431715L738.0904522613065,475.1423443185777L742.9145728643216,472.3688482956581L747.7386934673367,469.91782637662885L752.5628140703517,466.4702671944395L757.3869346733668,460.56451566660814L762.2110552763819,451.5474330723659L767.035175879397,440.10321915024264L771.8592964824121,427.92421004036606L776.6834170854271,416.79835736207406L781.5075376884422,407.81967980712926L786.3316582914573,401.2092691923629L791.1557788944724,396.65019454056585L795.9798994974875,393.7077336377911L800.8040201005025,392.051477762187L805.6281407035176,391.4813272733011L810.4522613065327,391.875779665645L815.2763819095478,393.14454401280886L820.1005025125628,395.20922654677355L824.9246231155778,398.02060120444895L829.7487437185929,401.64006690106226L834.572864321608,406.3727503745709L839.3969849246231,412.6935263564584L844.2211055276382,420.5182207463828L849.0452261306533,428.30152722827984L853.8693467336683,433.90986399832923L858.6934673366834,436.99436707171577L863.5175879396985,439.21888721293436L868.3417085427136,442.11094371989054L873.1658291457287,445.88983947449395L877.9899497487437,450.0287348184467L882.8140703517588,454.03368156337064L887.6381909547739,457.65319003150057L892.462311557789,460.7783937707529L897.2864321608041,463.35069953473493L902.1105527638191,465.3296256321429L906.9346733668342,466.68635316171714L911.7587939698492,467.4028709455954L916.5829145728643,467.47171320837555L921.4070351758794,466.8955749500471L926.2311557788944,465.6867723448822L931.0552763819095,463.866584963786L935.8793969849246,461.4645180561085L940.7035175879397,458.51751710825096L945.5276381909548,455.06915920719945L950.3517587939698,451.1688381228284L955.1758793969849,446.87095371069597L960,442.23411188059765L960,442.23411188059765L955.1758793969849,446.87095371069597L950.3517587939698,451.1688381228284L945.5276381909548,455.06915920719945L940.7035175879397,458.51751710825096L935.8793969849246,461.4645180561085L931.0552763819095,463.866584963786L926.2311557788944,465.6867723448822L921.4070351758794,466.8955749500471L916.5829145728643,467.47171320837555L911.7587939698492,467.4028709455954L906.9346733668342,466.68635316171714L902.1105527638191,465.3296256321429L897.2864321608041,463.35069953473493L892.462311557789,460.7783937707529L887.6381909547739,457.65319003150057L882.8140703517588,454.03368156337064L877.9899497487437,450.0287348184467L873.1658291457287,445.88983947449395L868.3417085427136,442.11094371989054L863.5175879396985,439.21888721293436L858.6934673366834,436.99436707171577L853.8693467336683,433.90986399832923L849.0452261306533,428.30152722827984L844.2211055276382,420.5182207463828L839.3969849246231,412.6935263564584L834.572864321608,406.3727503745709L829.7487437185929,401.64006690106226L824.9246231155778,398.02060120444895L820.1005025125628,395.20922654677355L815.2763819095478,393.14454401280886L810.4522613065327,391.875779665645L805.6281407035176,391.4813272733011L800.8040201005025,392.051477762187L795.9798994974875,393.7077336377911L791.1557788944724,396.65019454056585L786.3316582914573,401.2092691923629L781.5075376884422,407.81967980712926L776.6834170854271,416.79835736207406L771.8592964824121,427.92421004036606L767.035175879397,440.10321915024264L762.2110552763819,451.5474330723659L757.3869346733668,460.56451566660814L752.5628140703517,466.4702671944395L747.7386934673367,469.91782637662885L742.9145728643216,472.3688482956581L738.0904522613065,475.1423443185777L733.2663316582914,478.7773718431715L728.4422110552763,483.0575244546349L723.6180904522613,487.43867329759223L718.7939698492462,491.4328422635398L713.9698492462312,494.75173776728093L709.1457286432161,497.2773269141432L704.321608040201,498.98522149699426L699.497487437186,499.88681353178714L694.6733668341709,500L689.8492462311558,499.33870326894066L685.0251256281407,497.9118190639151L680.2010050251256,495.72633220714204L675.3768844221106,492.7919227326215L670.5527638190955,489.1256146331259L665.7286432160804,484.75571254192727L660.9045226130653,479.7247324130666L656.0804020100502,474.0912775930096L651.2562814070352,467.9308804589465L646.4321608040201,461.33595195992353L641.608040201005,454.41564043583674L636.7839195979899,447.2981054379912L631.9597989949748,440.13988236630723L627.1356783919598,433.1457868872478L622.3115577889448,426.5906533695142L617.4874371859297,420.8084398460177L612.6633165829146,416.0954750212846L607.8391959798995,412.5105474577812L603.0150753768845,409.66882008317566L598.1909547738694,406.7333992789574L593.3668341708543,402.7378863618668L588.5427135678392,397.1006198232043L583.7185929648241,389.97516224752576L578.894472361809,382.1782278722783L574.070351758794,374.76021655087516L569.2462311557789,368.524320226562L564.4221105527638,363.7804650160007L559.5979899497487,360.4095486896324L554.7738693467336,358.09612678259816L549.9497487437186,356.53105915937834L545.1256281407035,355.49535702792645L540.3015075376884,354.8569839843696L535.4773869346733,354.54271457352615L530.6532663316582,354.51885352081956L525.8291457286432,354.78558272510304L521.0050251256282,355.3786481869619L516.1809045226131,356.3720900215194L511.35678391959794,357.8781380276108L506.5326633165829,360.0420122670047L501.7085427135679,363.0302314282897L496.8844221105528,367.01196850660534L492.0603015075377,372.13460945457433L487.2361809045226,378.4969727323968L482.4120603015075,386.1257654517907L477.58793969849245,394.96124326307233L472.7638190954774,404.85567874169743L467.9396984924623,415.58401547538574L463.1155778894472,426.86247125501336L458.29145728643215,438.3696069166678L453.4673366834171,449.76508510955466L448.64321608040206,460.70284644997196L443.81909547738695,470.8378196132616L438.99497487437185,479.82939826587517L434.1708542713568,487.34992956180764L429.3467336683417,493.1086789715513L424.52261306532665,496.89673413595324L419.69849246231155,498.64531064263946L414.87437185929645,498.4749305063648L410.0502512562814,496.70681882819053L405.22613065326635,493.8188206315309L400.40201005025125,490.35367465133965L395.5778894472362,486.81328752400634L390.7537688442211,483.5813161166975L385.92964824120605,480.9000032020314L381.10552763819095,478.89436399013124L376.28140703517585,477.60807397440084L371.4572864321608,477.00936908816396L366.6331658291457,476.94449520764425L361.80904522613065,477.05366876151214L356.9849246231156,476.72401520796876L352.1608040201005,475.2039598588321L347.33668341708545,471.92300395091075L342.51256281407035,466.8350930700349L337.6884422110553,460.494144116286L332.8643216080402,453.772924294757L328.0402010050251,447.44699495969763L323.21608040201005,441.9405820916515L318.39195979899495,437.3305583867668L313.5678391959799,433.493695556038L308.74371859296485,430.2534648179344L303.91959798994975,427.46577365709334L299.0954773869347,425.0472317437798L294.2713567839196,422.969083408228L289.4472361809045,421.2394417656424L284.62311557788945,419.900239143628L279.79899497487435,419.1388171557058L274.9748743718593,419.8468006218861L270.1507537688442,424.7089476075063L265.3266331658291,437.21880191618845L260.5025125628141,454.97913217079963L255.67839195979897,466.02259226109885L250.85427135678395,461.29972442191746L246.03015075376885,447.2983435362442L241.20603015075375,436.5710746774282L236.3819095477387,433.25137443982715L231.5577889447236,434.3714304633969L226.73366834170855,436.9424705259148L221.90954773869348,439.8133598225249L217.0854271356784,442.6898643141682L212.26130653266333,445.4695025749412L207.43718592964822,448.07709448490056L202.61306532663318,450.4448632593503L197.7889447236181,452.5138857084334L192.96482412060303,454.23757009511513L188.14070351758792,455.5852647444762L183.31658291457285,456.5456084868514L178.4924623115578,457.12919855362026L173.66834170854273,457.37002095056357L168.84422110552765,457.3249808665812L164.02010050251255,457.0708484515728L159.19597989949747,456.69807043962334L154.37185929648243,456.30125091056266L149.54773869346735,455.9666942742226L144.72361809045225,455.7581876042846L139.89949748743717,455.70306299273034L135.0753768844221,455.7813300295012L130.25125628140705,455.92104868050177L125.42713567839198,456.0029385154584L120.60301507537687,455.876670850684L115.7788944723618,455.39101110214847L110.95477386934674,454.4399668969263L106.13065326633166,453.02375602501735L101.30653266331659,451.30798983775094L96.48241206030151,449.6318779205045L91.65829145728642,448.3881225432154L86.83417085427136,447.7366849309752L82.01005025125627,447.28117848219097L77.18592964824121,446.040359568841L72.36180904522612,442.9682416944018L67.53768844221105,437.7350264821307L62.71356783919599,430.9319039674027L57.8894472361809,423.2569056070669L53.06532663316583,414.9146893721333L48.24120603015076,406.5987914868609L43.41708542713568,399.9422017052368L38.59296482412061,395.8999138563375L33.768844221105525,394.0492665223452L28.94472361809045,393.5713797569896L24.12060301507538,393.9033311031428L19.296482412060303,394.7404308143057L14.472361809045225,395.9104958877405L9.648241206030152,397.30098893884104L4.824120603015076,398.8308380633L0,400.44982517513427Z"


    var size = [300, 50]

    var x = d3.scale.ordinal()
        .rangeRoundBands([0, size[0]], .2, 1);

    var y = d3.scale.linear()
        .range([size[1], 0]);

    x.domain(data.map(function (d) { return d.letter; }));
    y.domain([0, d3.max(data, function (d) { return d.frequency; })]);

    var base = subunit.select(scene)
      .each(function () {
        this.position.set(-(size[0] / 2), 0, 0);
      });

    var bars = base.selectAll(".bar")
      .data(data).enter()
      .append("mesh")
      .attr("class", "bar")
      .attr("material", blue)
      .attr("geometry", function (d) {
        var w = x.rangeBand();
        var h = size[1] - y(d.frequency);
        return new THREE.BoxGeometry(w, h, 5);
      })
      .each(function (d) {
        var x0 = x(d.letter);
        var y0 = - y(d.frequency) / 2;
        this.position.set(x0, y0, 240);
      });

    bars.each(function (d) {
      new TWEEN.Tween(this.position)
        .delay(5000)
        .to({ 
          x: Math.random() * 300, 
          y: Math.random() * 100, 
          z: Math.random() * 300}, 9000)
        .start();

      new TWEEN.Tween(this.rotation)
        .delay(5000)
        .to({ 
          x: Math.random() * 100, 
          y: Math.random() * 100, 
          z: Math.random() * 100}, 9000)
        .start();
    });

    var raycaster = new THREE.Raycaster();

    function onMouseDown (event) {

      var vector = new THREE.Vector3();

      var mouse = {
        x: (event.clientX / window.innerWidth) * 2 - 1,
        y: -(event.clientY / window.innerHeight ) * 2 + 1
      };

      vector.set(mouse.x, mouse.y , 0.5);
      vector.unproject(camera);

      raycaster.ray.set(camera.position, vector.sub(camera.position).normalize());

      var target = raycaster.intersectObjects(bars[0]);

      if (target.length) {
        console.log(target);
        subunit.selectObject(target[0].object)
          .attr("material", function (d) {
            if (this.material === blue) {
              return green;
            } else {
              return blue;
            }
          });
      }
    }

    document.addEventListener('click', onMouseDown, false);

    function render(time) {

      TWEEN.update(time);
      requestAnimationFrame(render);
      renderer.render(scene, camera);
    }
    render();

  </script>
  </body>
</html>